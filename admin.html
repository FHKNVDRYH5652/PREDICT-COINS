<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Panel</title>
  <style>
    body{background:#07121a;color:#eaf6ff;font-family:Inter,system-ui,Arial;margin:0;padding:20px}
    .wrap{max-width:600px;margin:auto}
    .card{background:rgba(255,255,255,0.05);padding:16px;border-radius:12px;margin-top:20px}
    input,button{padding:10px;border-radius:8px;border:none;margin-top:8px}
    input{width:100%}
    button{cursor:pointer;font-weight:700}
    .btn{background:linear-gradient(90deg,#00ff9d,#1dd3ff);color:#001}
  </style>
</head>
<body>
<div class="wrap">
  <h2>Admin Access</h2>
  <div id="loginBox" class="card">
    <div>Enter Admin Password:</div>
    <input type="password" id="adminPass" placeholder="Password">
    <button id="loginBtn" class="btn">Unlock</button>
  </div>

  <div id="panel" class="card" style="display:none">
    <h3>Period Control</h3>
    <div>Current Period: <strong id="curPeriod">----</strong></div>
    <div style="margin-top:12px">
      <label>Set Last 3 Digits:</label>
      <input type="number" id="last3" min="1" max="999" placeholder="e.g. 256">
      <button id="setBtn" class="btn">Set Period</button>
    </div>
    <div class="card" style="margin-top:16px">
      <h4>Auto Increment</h4>
      <div>Every 60s last 3 digits will +1 (reset to 001 after 999)</div>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyBs7eQyMrcN8kJWMHl2ac2UZHlYQ6DypD8",
    authDomain: "terminal-xxrr.firebaseapp.com",
    databaseURL: "https://terminal-xxrr-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "terminal-xxrr",
    storageBucket: "terminal-xxrr.appspot.com",
    messagingSenderId: "722753278120",
    appId: "1:722753278120:web:bfa37aab39635a4e57f29d"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const PASS = "457"; // Hidden Admin Pass (मत लिखना कहीं भी)

  const loginBox = document.getElementById("loginBox");
  const panel = document.getElementById("panel");
  const adminPass = document.getElementById("adminPass");
  const loginBtn = document.getElementById("loginBtn");
  const curPeriodEl = document.getElementById("curPeriod");
  const last3 = document.getElementById("last3");
  const setBtn = document.getElementById("setBtn");

  let basePrefix = "20250915100010"; // स्थिर prefix (date + code)
  let currentLast3 = 1;

  // Firebase listener
  const periodDoc = doc(db,"system","period");
  onSnapshot(periodDoc,snap=>{
    if(snap.exists()){
      curPeriodEl.innerText = snap.data().number;
    }
  });

  // Login
  loginBtn.onclick = ()=>{
    if(adminPass.value === PASS){
      loginBox.style.display="none";
      panel.style.display="block";
    }else{
      alert("Wrong Password!");
    }
  };

  // Set Period
  setBtn.onclick = async ()=>{
    let val = parseInt(last3.value,10);
    if(isNaN(val) || val<1 || val>999){ alert("Enter 1–999"); return; }
    currentLast3 = val;
    await savePeriod();
    startAutoIncrement();
  };

  // Save Period in Firestore
  async function savePeriod(){
    const formatted = String(currentLast3).padStart(3,"0");
    const num = basePrefix + formatted;
    await setDoc(periodDoc,{ number:num });
  }

  // Auto increment every 60s
  function startAutoIncrement(){
    setInterval(async ()=>{
      currentLast3++;
      if(currentLast3>999) currentLast3=1;
      await savePeriod();
    },60000);
  }
</script>
</body>
</html>

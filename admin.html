<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin — Coin Predictions</title>
  <style>
    :root{--bg:#061021;--card:rgba(255,255,255,0.03);--accent:#00a6ff}
    *{box-sizing:border-box;font-family:Inter,system-ui,Arial}
    body{margin:0;background:linear-gradient(180deg,#041020,#071427);color:#eaf6ff;padding:24px}
    .wrap{max-width:1100px;margin:0 auto}
    .loginCard{max-width:420px;margin:40px auto;background:var(--card);padding:20px;border-radius:12px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .card{background:var(--card);padding:14px;border-radius:12px}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;margin-top:8px}
    .btn{background:linear-gradient(90deg,#00d2a8,#00a6ff);padding:10px 12px;border-radius:8px;border:none;color:#001;font-weight:700;cursor:pointer}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:#9fb0d6;cursor:pointer}
    .small{font-size:13px;color:#9fb0d6}
    .history{max-height:420px;overflow:auto;padding:8px;border-radius:8px;background:rgba(0,0,0,0.25)}
  </style>
</head>
<body>
  <div class="wrap">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div style="font-weight:800">Admin Dashboard</div>
      <div class="small">Demo admin (password: <code>Mrperfect456</code>)</div>
    </div>

    <!-- Login area -->
    <div id="loginArea" class="loginCard card">
      <h2 style="margin:0">Admin Login</h2>
      <div class="small" style="margin-top:8px">Enter password to view pending payments and approve.</div>
      <input id="adminPass" type="password" placeholder="Password" />
      <div style="margin-top:10px;display:flex;gap:8px">
        <button class="btn" id="loginBtn">Login</button>
        <button class="ghost" id="backBtn">Back to Site</button>
      </div>
      <div id="loginMsg" class="small" style="margin-top:8px"></div>
    </div>

    <!-- Dashboard (hidden until login) -->
    <div id="dash" style="display:none">
      <div class="grid">
        <div class="card">
          <h3>Pending Payments</h3>
          <div id="pendingList" class="history"></div>
        </div>

        <div class="card">
          <h3>Approved / Rejected</h3>
          <div style="margin-bottom:8px">
            <button class="btn" id="refreshBtn">Refresh</button>
            <button class="ghost" id="logoutBtn">Logout</button>
          </div>
          <div style="margin-top:8px" class="small">Approved</div>
          <div id="approvedList" class="history" style="margin-top:6px"></div>
          <div style="margin-top:8px" class="small">Rejected</div>
          <div id="rejectedList" class="history" style="margin-top:6px"></div>
        </div>
      </div>

      <div style="margin-top:12px" class="card">
        <h3>Wallet (single-user demo)</h3>
        <div class="small">Current wallet coins (for demo user): <b id="walletCount">0</b></div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <input id="setCoinsInput" placeholder="set coins number" />
          <button class="btn" id="setCoinsBtn">Set Wallet</button>
        </div>
      </div>
    </div>
  </div>

<script>
  const ADMIN_PASS = 'Mrperfect456';

  function readJSON(k, fallback=null){ try{ const v = localStorage.getItem(k); return v? JSON.parse(v): fallback; }catch(e){ return fallback; } }
  function writeJSON(k,v){ localStorage.setItem(k, JSON.stringify(v)); }

  // login
  document.getElementById('loginBtn').addEventListener('click', ()=>{
    const pw = document.getElementById('adminPass').value;
    if(pw === ADMIN_PASS){ document.getElementById('loginArea').style.display='none'; document.getElementById('dash').style.display='block'; renderAll(); }
    else document.getElementById('loginMsg').innerText = 'Wrong password';
  });
  document.getElementById('backBtn').addEventListener('click', ()=> window.location.href = 'index.html');

  function listPending(){
    const items = [];
    for(let i=0;i<localStorage.length;i++){
      const k = localStorage.key(i);
      if(k && k.startsWith('__pending__')) {
        const v = readJSON(k);
        if(v) items.push({key:k, val:v});
      }
    }
    items.sort((a,b)=>b.val.ts - a.val.ts);
    return items;
  }

  function renderPending(){
    const node = document.getElementById('pendingList');
    node.innerHTML = '';
    const items = listPending();
    if(items.length===0){ node.innerHTML = '<div class="small">No pending</div>'; return; }
    items.forEach(it=>{
      const d = it.val;
      const row = document.createElement('div');
      row.style.padding='8px'; row.style.borderBottom='1px solid rgba(255,255,255,0.04)';
      row.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
        <div><b>${d.coins} coins</b> — ₹${(d.amount).toFixed(2)}<div class="small">UTR: ${d.utr} • ${new Date(d.ts).toLocaleString()}</div></div>
        <div><button class="btn approve" data-utr="${d.utr}">Approve</button> <button class="ghost reject" data-utr="${d.utr}">Reject</button></div>
      </div>`;
      node.appendChild(row);
    });
    // attach handlers
    Array.from(node.querySelectorAll('.approve')).forEach(b=> b.onclick = ()=> adminApprove(b.dataset.utr));
    Array.from(node.querySelectorAll('.reject')).forEach(b=> b.onclick = ()=> adminReject(b.dataset.utr));
  }

  function adminApprove(utr){
    const key = '__pending__' + utr;
    const data = readJSON(key);
    if(!data) { alert('Not found'); return; }
    // credit wallet (single-user demo)
    const cur = parseInt(localStorage.getItem('wallet_coins')||'0',10);
    localStorage.setItem('wallet_coins', String(cur + Number(data.coins)));
    // move to approved
    localStorage.setItem('__approved__' + utr, JSON.stringify({utr:utr, coins:data.coins, amount:data.amount, ts: Date.now()}));
    localStorage.removeItem(key);
    renderAll();
    alert('Approved and wallet credited: ' + data.coins + ' coins');
  }

  function adminReject(utr){
    const key = '__pending__' + utr;
    const data = readJSON(key);
    if(!data) { alert('Not found'); return; }
    localStorage.setItem('__rejected__' + utr, JSON.stringify({utr:utr, coins:data.coins, amount:data.amount, ts: Date.now()}));
    localStorage.removeItem(key);
    renderAll();
    alert('Rejected UTR: ' + utr);
  }

  function renderApprovedRejected(){
    const approved = [], rejected = [];
    for(let i=0;i<localStorage.length;i++){
      const k = localStorage.key(i);
      if(k && k.startsWith('__approved__')) approved.push(readJSON(k));
      if(k && k.startsWith('__rejected__')) rejected.push(readJSON(k));
    }
    const aNode = document.getElementById('approvedList');
    const rNode = document.getElementById('rejectedList');
    aNode.innerHTML = approved.length? approved.map(a=> `<div style="padding:6px;border-bottom:1px solid rgba(255,255,255,0.03)"><b>${a.coins} coins</b> • UTR:${a.utr} • ${new Date(a.ts).toLocaleString()}</div>`).join('') : '<div class="small">No approved</div>';
    rNode.innerHTML = rejected.length? rejected.map(a=> `<div style="padding:6px;border-bottom:1px solid rgba(255,255,255,0.03)"><b>${a.coins} coins</b> • UTR:${a.utr} • ${new Date(a.ts).toLocaleString()}</div>`).join('') : '<div class="small">No rejected</div>';
  }

  document.getElementById('refreshBtn').addEventListener('click', renderAll);
  document.getElementById('logoutBtn').addEventListener('click', ()=> { document.getElementById('dash').style.display='none'; document.getElementById('loginArea').style.display='block'; });

  function renderWallet(){
    document.getElementById('walletCount').innerText = localStorage.getItem('wallet_coins') || '0';
  }
  document.getElementById('setCoinsBtn').addEventListener('click', ()=>{
    const v = parseInt(document.getElementById('setCoinsInput').value||'0',10);
    if(isNaN(v)){ alert('Enter number'); return; }
    localStorage.setItem('wallet_coins', String(v));
    renderWallet();
    alert('Wallet set to ' + v);
  });

  function renderAll(){ renderPending(); renderApprovedRejected(); renderWallet(); }

</script>
</body>
</html>
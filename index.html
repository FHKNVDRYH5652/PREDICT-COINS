<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Loss Recovery — Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#071022; --card:#0f1724; --muted:#9fb0d6; --accent:#ff6b6b; --accent2:#ffd166;
}
*{box-sizing:border-box;font-family:'Poppins',sans-serif}
body{margin:0;background:linear-gradient(180deg,#061021,#07142a);color:#eaf6ff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:18px}
.app{width:100%;max-width:980px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 20px 60px rgba(0,0,0,0.6);position:relative;overflow:hidden}
.background{position:absolute;inset:0;opacity:0.06;background-image:url('anime.png');background-size:cover;background-position:center;filter:blur(2px)}
.header{display:flex;align-items:center;gap:12px}
.logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(90deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:900;color:#071022}
.title{font-size:18px;font-weight:800}
.subtitle{color:var(--muted);font-size:13px}
.container{margin-top:18px}
.card{background:transparent;padding:18px;border-radius:10px}
.center{display:flex;flex-direction:column;align-items:center;gap:12px;text-align:center}
.bigbtn{padding:12px 18px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#071022;font-weight:800;cursor:pointer}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:10px 12px;border-radius:8px;cursor:pointer}
.input{padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:inherit;width:220px;text-align:center}
.row{display:flex;gap:8px;align-items:center;justify-content:center}
.plans{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px}
.plan{padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));cursor:pointer;min-width:140px}
.plan.selected{box-shadow:0 10px 30px rgba(0,0,0,0.5);transform:translateY(-6px)}
.small{font-size:13px;color:var(--muted)}
.qr{width:260px;height:260px;border-radius:12px;border:4px solid rgba(255,255,255,0.03);object-fit:cover}
.hidden{display:none}
.footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
.admin-cross{position:fixed;right:18px;bottom:18px;width:44px;height:44px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;cursor:pointer;z-index:999}
.panel{position:fixed;right:18px;top:18px;width:360px;background:rgba(0,0,0,0.6);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);z-index:999;box-shadow:0 12px 40px rgba(0,0,0,0.6)}
.list{max-height:320px;overflow:auto;margin-top:8px}
.item{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;justify-content:space-between;align-items:center;gap:8px}
.badge{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.03);font-weight:700}
.step{border-radius:8px;padding:14px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);margin-top:12px}
.success{color:#b4f8c8}
.warn{color:#ffd6a5}
</style>
</head>
<body>
<div class="app" role="application">
  <div class="background" aria-hidden="true"></div>

  <div class="header">
    <div class="logo">LR</div>
    <div>
      <div class="title">Loss Recovery</div>
      <div class="subtitle">Smart, guided loss recovery — voice assisted</div>
    </div>
  </div>

  <div class="container">
    <!-- Pages (show/hide by id) -->
    <!-- 1: Welcome -->
    <div id="page-welcome" class="card center">
      <h2>Welcome to Loss Recovery</h2>
      <p class="small">Apka swagat hai — hum aapki madad karenge aapka loss recover karne mein.</p>
      <button class="bigbtn" id="welcomeNext">Next</button>
      <div class="small">(Voice guidance enabled)</div>
    </div>

    <!-- 2: Enter amount -->
    <div id="page-amount" class="card center hidden">
      <h3>How much is your loss?</h3>
      <input id="lossAmount" class="input" type="number" placeholder="Enter amount in Rs" min="1"/>
      <div class="row" style="margin-top:10px">
        <button class="bigbtn" id="confirmAmount">Confirm</button>
        <button class="ghost" id="amountBack">Back</button>
      </div>
      <div class="small">Amount dala jaayega aur voice se confirm hogi</div>
    </div>

    <!-- 3: Plan selection -->
    <div id="page-plans" class="card center hidden">
      <h3>Choose recovery plan</h3>
      <div class="small">Plans ke price loss amount ke % par based honge</div>
      <div class="plans" id="plansBox">
        <!-- plans inserted by JS -->
      </div>
      <div class="row" style="margin-top:12px">
        <button class="bigbtn" id="choosePlanBtn">Proceed to Payment</button>
        <button class="ghost" id="plansBack">Back</button>
      </div>
    </div>

    <!-- 4: Payment page -->
    <div id="page-payment" class="card center hidden">
      <h3>Payment</h3>
      <div class="small">Scan QR and pay exact amount for the chosen plan. Then enter 12-digit UTR and confirm.</div>
      <img src="qr.png" alt="QR" class="qr" id="qrImg" onerror="this.src='';" />
      <div style="margin-top:10px"><input id="utrInput" class="input" placeholder="Enter 12-digit UTR" maxlength="12"></div>
      <div class="row" style="margin-top:10px">
        <button class="bigbtn" id="submitPayment">Submit UTR & Request Approval</button>
        <button class="ghost" id="paymentBack">Back</button>
      </div>
      <div style="margin-top:10px" class="small">If approval delayed, contact: <a href="https://t.me/Nskskssiwi" target="_blank" style="color:#bfe">Customer Service</a></div>
      <div id="paymentStatus" class="small" style="margin-top:8px"></div>
    </div>

    <!-- 5: Strategy page -->
    <div id="page-strategy" class="card hidden">
      <h3>Recovery Strategy</h3>
      <div id="strategyIntro" class="small">Preparing your step-by-step recovery plan...</div>

      <div id="strategySteps" class="step hidden"></div>

      <div class="row" style="margin-top:12px">
        <button class="bigbtn" id="strategyNext" disabled>Next Step</button>
        <button class="ghost" id="strategyFinish" style="display:none">Finish</button>
      </div>
      <div id="strategyNote" class="small" style="margin-top:10px"></div>
    </div>

    <div class="footer">This is a demo — Not financial advice. Keep screenshots for approvals.</div>
  </div>

  <!-- hidden admin cross -->
  <div class="admin-cross" id="adminCross" title="Admin">❌</div>

  <!-- admin panel -->
  <div id="adminPanel" class="panel hidden" role="dialog" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:800">Admin Panel</div>
      <div class="small">Locked</div>
    </div>

    <div style="margin-top:8px">
      <input id="adminPass" class="input" placeholder="Enter admin password" type="password"/>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="bigbtn" id="adminLoginBtn">Login</button>
        <button class="ghost" id="adminCloseBtn">Close</button>
      </div>
    </div>

    <div id="adminControls" class="hidden">
      <div style="margin-top:12px;font-weight:700">Pending Payments</div>
      <div class="list" id="pendingList"></div>
      <div style="margin-top:8px" class="small">Approve will notify the user (localStorage based demo)</div>
    </div>
  </div>

</div>

<script>
/* Loss Recovery SPA (single-file)
   - Voice via SpeechSynthesis (Hindi)
   - Admin approvals via localStorage: pending_<utr> and approved_<utr>
   - Admin panel hidden behind cross; password: 456
*/

const pages = {
  welcome: document.getElementById('page-welcome'),
  amount: document.getElementById('page-amount'),
  plans: document.getElementById('page-plans'),
  payment: document.getElementById('page-payment'),
  strategy: document.getElementById('page-strategy')
};

let state = {
  lossAmount: 0,
  chosenPlan: null,
  chosenPlanPrice: 0,
  chosenPlanKey: null,
  pendingUTR: null
};

function showPage(name){
  Object.values(pages).forEach(p=>p.classList.add('hidden'));
  pages[name].classList.remove('hidden');
  // spoken guidance for each page
  if(name === 'welcome') speakHindi('स्वागत है Loss Recovery में। आगे बढ़ने के लिए नेक्स्ट दबाएं।');
  else if(name === 'amount') speakHindi('कितना नुकसान हुआ है? कृपया राशि दर्ज करें और कन्फर्म करें।');
  else if(name === 'plans') speakHindi('अपना प्लान चुनें। आपकी राशि के अनुसार प्राइस दिखाई देगा।');
  else if(name === 'payment') speakHindi('क्यूआर से भुगतान करें और 12 अंकों का U T R डालकर सबमिट करें।');
  else if(name === 'strategy') speakHindi('आपका रिकवरि योजना तैयार हो रही है। कृपया आगे बढ़ें।');
}

/* Speech */
function speakHindi(text){
  try{
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = 'hi-IN';
    msg.rate = 0.95;
    msg.pitch = 0.9;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(msg);
  }catch(e){}
}

/* Welcome flow */
document.getElementById('welcomeNext').addEventListener('click', ()=>{
  showPage('amount');
});

/* Amount page */
document.getElementById('amountBack').addEventListener('click', ()=> showPage('welcome'));

document.getElementById('confirmAmount').addEventListener('click', ()=>{
  const v = Number(document.getElementById('lossAmount').value);
  if(!v || v <= 0){ alert('कृपया सही राशि दर्ज करें'); return; }
  state.lossAmount = Math.round(v);
  speakHindi(`आपका नुकसान ${state.lossAmount} रुपये दर्ज किया गया है। चिंता न करें, हम इसे रिकवर कर देंगे।`);
  setTimeout(()=> showPlansPage(), 900);
});

/* Plans computation */
const plansDef = [
  {key:'3m', label:'3 Months', pct:7},
  {key:'1m', label:'1 Month', pct:12.5},
  {key:'1w', label:'1 Week', pct:15},
  {key:'3d', label:'3 Days', pct:20},
  {key:'1d', label:'1 Day', pct:25}
];

function showPlansPage(){
  const box = document.getElementById('plansBox');
  box.innerHTML = '';
  plansDef.forEach(p=>{
    const price = Math.max(1, Math.round(state.lossAmount * (p.pct/100) * 100)/100);
    const div = document.createElement('div');
    div.className = 'plan';
    div.id = 'plan-' + p.key;
    div.innerHTML = `<div style="font-weight:800">${p.label}</div>
      <div class="small">${p.pct}% of loss</div>
      <div style="margin-top:8px;font-weight:700">₹ ${price.toFixed(2)}</div>`;
    div.addEventListener('click', ()=> {
      document.querySelectorAll('.plan').forEach(x=>x.classList.remove('selected'));
      div.classList.add('selected');
      state.chosenPlan = p;
      state.chosenPlanPrice = Number(price.toFixed(2));
      state.chosenPlanKey = p.key;
      speakHindi(`${p.label} चुना गया। कृपया अगला दबाएं और भुगतान करें।`);
    });
    box.appendChild(div);
  });
  showPage('plans');
}

document.getElementById('plansBack').addEventListener('click', ()=> showPage('amount'));

document.getElementById('choosePlanBtn').addEventListener('click', ()=>{
  if(!state.chosenPlan){ alert('कृपया कोई प्लान चुनें'); return; }
  // go to payment
  document.getElementById('paymentStatus').innerText = '';
  document.getElementById('utrInput').value = '';
  document.getElementById('qrImg').src = 'qr.png';
  showPage('payment');
  speakHindi(`आपने ${state.chosenPlan.label} चुना है। भुगतान अमाउंट ${state.chosenPlanPrice} रुपये है। कृपया QR से भुगतान करें और U T R डालें।`);
});

/* Payment page */
document.getElementById('paymentBack').addEventListener('click', ()=> showPage('plans'));

document.getElementById('submitPayment').addEventListener('click', ()=>{
  const utr = document.getElementById('utrInput').value.trim();
  if(!/^[0-9]{12}$/.test(utr)){ alert('कृपया 12 अंकों का सही U T R डालें'); return; }
  const key = 'pending_' + utr;
  const payload = {
    utr, amount: state.chosenPlanPrice, plan: state.chosenPlanKey, loss: state.lossAmount, ts: Date.now()
  };
  try{
    localStorage.setItem(key, JSON.stringify(payload));
    state.pendingUTR = utr;
    document.getElementById('paymentStatus').innerText = 'Payment submitted — awaiting admin approval.';
    speakHindi(`आपका भुगतान अनुरोध भेज दिया गया है। U T R ${utr} जमा किया गया है। एडमिन अप्रूवल के बाद आगे बढ़ेंगे।`);
    // start listening for approval (storage event handles cross-tab; also poll for same-tab)
    startApprovalPoll(utr);
  }catch(e){
    alert('Storage error: ' + e);
  }
});

/* approval detection */
let approvalInterval = null;
function startApprovalPoll(utr){
  stopApprovalPoll();
  approvalInterval = setInterval(()=> {
    const apr = localStorage.getItem('approved_' + utr);
    if(apr){
      stopApprovalPoll();
      onApproved(utr);
    }
  }, 1200);
}
function stopApprovalPoll(){ if(approvalInterval){ clearInterval(approvalInterval); approvalInterval = null; } }

window.addEventListener('storage', (ev)=>{
  if(!ev.key) return;
  if(ev.key.startsWith('approved_')){
    const utr = ev.key.replace('approved_','');
    if(state.pendingUTR === utr){
      onApproved(utr);
    }
  }
});

function onApproved(utr){
  document.getElementById('paymentStatus').innerText = '✅ Approved by admin. Preparing your recovery strategy...';
  speakHindi('आपका भुगतान अप्रूव हो गया है। अब हम आपकी रिकवरी योजना तैयार करते हैं।');
  setTimeout(()=> {
    // navigate to strategy and create steps
    createStrategy(state.lossAmount, state.chosenPlanKey);
    showPage('strategy');
  }, 1500);
}

/* Admin panel logic */
const adminCross = document.getElementById('adminCross');
const adminPanel = document.getElementById('adminPanel');
const adminLoginBtn = document.getElementById('adminLoginBtn');
const adminPass = document.getElementById('adminPass');
const adminCloseBtn = document.getElementById('adminCloseBtn');
const adminControls = document.getElementById('adminControls');
const pendingList = document.getElementById('pendingList');

adminCross.addEventListener('click', ()=> {
  // toggle admin panel
  adminPanel.classList.toggle('hidden');
});

adminCloseBtn.addEventListener('click', ()=> adminPanel.classList.add('hidden'));

// password 456 as requested
adminLoginBtn.addEventListener('click', ()=> {
  const p = adminPass.value || '';
  if(p === '456'){
    adminControls.classList.remove('hidden');
    document.getElementById('adminPass').value = '';
    renderPending();
    speakHindi('एडमिन पैनल ओपन हो गया है। पेंडिंग पेमेंट्स दिख रहे हैं।');
  } else {
    alert('Incorrect admin password');
  }
});

function renderPending(){
  pendingList.innerHTML = '';
  // iterate localStorage keys for pending_
  for(let i=0;i<localStorage.length;i++){
    const k = localStorage.key(i);
    if(k && k.startsWith('pending_')){
      try{
        const payload = JSON.parse(localStorage.getItem(k));
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `<div>
          <div style="font-weight:800">${payload.utr} • ₹${payload.amount}</div>
          <div class="small">loss ₹${payload.loss} • plan ${payload.plan}</div>
        </div>`;
        const btns = document.createElement('div');
        const approve = document.createElement('button');
        approve.className = 'bigbtn';
        approve.textContent = 'Approve';
        approve.addEventListener('click', ()=> {
          localStorage.setItem('approved_'+payload.utr, JSON.stringify({by:'admin',ts:Date.now(),payload}));
          // optionally remove pending
          localStorage.removeItem(k);
          renderPending();
          alert('Approved ' + payload.utr);
        });
        const reject = document.createElement('button');
        reject.className = 'ghost';
        reject.textContent = 'Reject';
        reject.addEventListener('click', ()=>{
          localStorage.removeItem(k);
          renderPending();
          alert('Rejected ' + payload.utr);
        });
        btns.appendChild(approve);
        btns.appendChild(reject);
        div.appendChild(btns);
        pendingList.appendChild(div);
      }catch(e){}
    }
  }
}

/* Strategy creation
   - Generate steps based on loss amount & plan
   - Speak each step in Hindi when shown
*/
const strategyStepsEl = document.getElementById('strategySteps');
const strategyNextBtn = document.getElementById('strategyNext');
const strategyFinishBtn = document.getElementById('strategyFinish');
const strategyIntro = document.getElementById('strategyIntro');
const strategyNote = document.getElementById('strategyNote');

let currentStepIndex = 0;
let generatedSteps = [];

function createStrategy(lossAmnt, planKey){
  generatedSteps = [];
  currentStepIndex = 0;

  // plan multipliers and schedules (rough)
  const planMap = {
    '3m': {label:'3 Months', days:90, feePct:7},
    '1m': {label:'1 Month', days:30, feePct:12.5},
    '1w': {label:'1 Week', days:7, feePct:15},
    '3d': {label:'3 Days', days:3, feePct:20},
    '1d': {label:'1 Day', days:1, feePct:25}
  };
  const plan = planMap[planKey] || planMap['1m'];
  const fee = Math.round((lossAmnt * (plan.feePct/100))*100)/100;

  // step 0: intro
  generatedSteps.push({
    title: `Plan: ${plan.label}`,
    text: `आपने ${plan.label} चुना है। प्लान का प्राइस ₹${fee} है। अब हम ज़रूरी स्टेप्स बतायेंगे।`
  });

  // step 1: deposit 5% initial (as example)
  const deposit = Math.max(1, Math.round(lossAmnt * 0.05 * 100)/100);
  generatedSteps.push({
    title:'Step 1: Initial Deposit',
    text: `आरम्भ के लिए ${deposit} रुपये जमा करें (कुल नुकसान का 5%). यह आपके पहले माइक्रो-बेट के लिए बैलेंस तैयार करेगा।`
  });

  // step 2: Open WINGO 1 min (instruction)
  generatedSteps.push({
    title:'Step 2: Open WINGO 1 min',
    text: `WINGO 1-min खोलें और उस समय के अनुसार हमारे सुझावों को फॉलो करें। हर दिन लक्ष्य पूरा करने पर Next पर क्लिक करें।`
  });

  // step 3: daily targets splitting
  const days = plan.days;
  const dailyTarget = Math.max(1, Math.round((lossAmnt / days) * 100)/100);
  generatedSteps.push({
    title:'Step 3: Daily target',
    text: `हर दिन का लक्ष्य: ₹${dailyTarget} कमाना। छोटे-छोटे बेट्स में यह आसान रहेगा।`
  });

  // step 4: betting levels (15/30/55 logic)
  generatedSteps.push({
    title:'Step 4: Bet sizing',
    text: `हम तीन स्तर सुझाते हैं: Level1 = 15%, Level2 = 30%, Level3 = 55% (जरूरत अनुसार)। Loss होने पर अगले Level पर जाएं।`
  });

  // step 5: safety & skip
  generatedSteps.push({
    title:'Step 5: Safety rules',
    text: `अगर दो बार लगातार Loss हों तो strategy बदलें और छोटा बैट चुनें। एक ही round में अत्यधिक जोखिम न लें।`
  });

  // step 6: timeline & completion
  generatedSteps.push({
    title:'Final: Goal & completion',
    text: `यदि आपने निर्धारित लक्ष्य पूरा कर लिया तो Complete बटन दबाएँ। हम हर दिन प्रोग्रेस रिकॉर्ड करेंगे।`
  });

  // render
  renderStrategy();
  speakHindi(`आपका ${plan.label} प्लान सेट हो गया है। कुल फीस ${fee} रुपये है। आगे बढ़ने के लिए नेक्स्ट दबाइए।`);
}

function renderStrategy(){
  strategyStepsEl.innerHTML = '';
  generatedSteps.forEach((s, idx)=>{
    const d = document.createElement('div');
    d.className = 'step';
    d.id = 'step-' + idx;
    d.innerHTML = `<div style="font-weight:800">${s.title}</div><div style="margin-top:6px">${s.text}</div>`;
    if(idx !== currentStepIndex) d.style.display = 'none';
    strategyStepsEl.appendChild(d);
  });
  strategyStepsEl.classList.remove('hidden');
  strategyNextBtn.disabled = false;
  strategyNextBtn.style.display = 'inline-block';
  strategyFinishBtn.style.display = 'none';
  strategyIntro.innerText = `आपने कुल ${generatedSteps.length} स्टेप्स पाए। अब पहला स्टेप दिखाया है।`;
  speakCurrentStep();
}

function speakCurrentStep(){
  const s = generatedSteps[currentStepIndex];
  if(s) speakHindi(s.text);
}

strategyNextBtn.addEventListener('click', ()=>{
  if(currentStepIndex < generatedSteps.length -1){
    // hide current
    const cur = document.getElementById('step-' + currentStepIndex);
    if(cur) cur.style.display = 'none';
    currentStepIndex++;
    const nxt = document.getElementById('step-' + currentStepIndex);
    if(nxt) nxt.style.display = 'block';
    speakCurrentStep();
    if(currentStepIndex === generatedSteps.length -1){
      strategyNextBtn.disabled = true;
      strategyNextBtn.style.display = 'none';
      strategyFinishBtn.style.display = 'inline-block';
      strategyFinishBtn.disabled = false;
      strategyNote.innerText = 'आप अंतिम स्टेप पर हैं — पूरा करने के लिए Finish दबाएं।';
    } else {
      strategyNote.innerText = `Step ${currentStepIndex+1} of ${generatedSteps.length}`;
    }
  }
});

strategyFinishBtn.addEventListener('click', ()=>{
  speakHindi('बधाई हो। आपने अपनी Recovery योजना शुरू की। रोज के टास्क पर दीक्षा करें।');
  alert('Recovery plan started. Return to welcome to start new flow.');
  // reset
  location.reload();
});

/* Utilities */
// small helper to auto-approve for demo (REMOVE in production)
function autoApproveForDemo(){
  // no-op; admin must approve manually via admin panel
}

/* initialize */
(function init(){
  showPage('welcome');
  // greet voice
  speakHindi('Welcome to Loss Recovery. आपका स्वागत है। आगे बढ़ने के लिए Next दबाएँ।');
})();

</script>
</body>
</html>

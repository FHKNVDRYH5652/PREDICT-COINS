<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Prediction — Coin Predictions</title>
<link rel="icon" href="favicon.ico"/>
<script src="https://cdn.jsdelivr.net/npm/tsparticles@2.11.1/tsparticles.bundle.min.js"></script>
<style>
  :root{--panel:rgba(255,255,255,0.04);--neon:#00ff9d;--accent:#1dd3ff;--muted:#9fb0d6}
  body{margin:0;padding:24px;background:url('anime2.png') center/cover fixed;color:#eaf6ff;font-family:Inter,Arial}
  #tsparticles{position:fixed;inset:0;z-index:0}
  .wrap{position:relative;z-index:2;max-width:960px;margin:auto}
  .card{background:var(--panel);padding:18px;border-radius:14px;box-shadow:0 10px 25px rgba(0,0,0,0.6)}
  .btn{background:linear-gradient(90deg,var(--neon),var(--accent));padding:10px 14px;border:none;border-radius:8px;color:#001;font-weight:700;cursor:pointer}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.1);padding:8px 12px;border-radius:8px;color:var(--muted);cursor:pointer}
  .small{font-size:13px;color:var(--muted)}
  #resultBox{margin-top:16px;padding:14px;background:rgba(0,0,0,0.4);border-radius:10px}
</style>
</head>
<body>
<div id="tsparticles"></div>
<div class="wrap">
  <div class="card">
    <h2 style="margin:0 0 10px 0">Generate Prediction</h2>
    <div class="small">Each prediction costs <b>10 coins</b>. Your current wallet: <span id="walletTop">0</span> coins.</div>
    <div style="margin-top:12px;display:flex;gap:10px">
      <button id="genBtn" class="btn">Generate</button>
      <button id="backBtn" class="ghost">Back to Plans</button>
    </div>
    <div id="resultBox" class="small">No prediction yet.</div>
  </div>
</div>

<audio id="sndClick" src="click.mp3"></audio>
<audio id="sndHover" src="hover.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore,doc,onSnapshot,runTransaction } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBs7eQyMrcN8kJWMHl2ac2UZHlYQ6DypD8",
  authDomain: "terminal-xxrr.firebaseapp.com",
  projectId: "terminal-xxrr",
  storageBucket: "terminal-xxrr.appspot.com",   // ✅ FIXED
  messagingSenderId: "722753278120",
  appId: "1:722753278120:web:bfa37aab39635a4e57f29d"
};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

// particles
tsParticles.load("tsparticles",{fpsLimit:60,particles:{number:{value:30},color:{value:"#00ff9d"},links:{enable:true,distance:120,color:"#00ff9d",opacity:0.1},move:{enable:true,speed:0.9}}});

const walletEl=document.getElementById('walletTop');
const resultBox=document.getElementById('resultBox');

onAuthStateChanged(auth,user=>{
  if(user){
    onSnapshot(doc(db,"users",user.uid),s=>{
      walletEl.innerText=s.exists()?s.data().wallet:0;
    });
  }else{
    alert("Login required");location.href="index.html";
  }
});

document.getElementById('genBtn').onclick=async()=>{
  const user=auth.currentUser;
  if(!user){alert("Login required");return;}
  try{
    await runTransaction(db,async(t)=>{
      const ref=doc(db,"users",user.uid);
      const snap=await t.get(ref);
      if(!snap.exists())throw "No wallet doc";
      let bal=snap.data().wallet||0;
      if(bal<10)throw "Not enough coins";
      t.update(ref,{wallet:bal-10});
      return bal-10;
    });
    // generate dummy prediction
    const outcomes=["BUY","SELL","HOLD"];
    const pick=outcomes[Math.floor(Math.random()*outcomes.length)];
    resultBox.innerHTML=`<b>Prediction:</b> ${pick}`;
  }catch(e){
    resultBox.innerText="Error: "+e;
  }
};

document.getElementById('backBtn').onclick=()=>location.href="index.html";
</script>
</body>
</html>
